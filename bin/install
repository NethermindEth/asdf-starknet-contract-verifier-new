#!/bin/bash

echo "Starting installation..."
echo "Arguments received: $@"

# Get the version to install
version="$1"
install_path="$2"

echo "Version: $version"
echo "Install path: $install_path"

# Create a temporary directory
temp_dir=$(mktemp -d)
trap 'rm -rf "$temp_dir"' EXIT

echo "Created temp directory: $temp_dir"

# Clone the repository
git clone https://github.com/NethermindEth/starknet-contract-verifier.git "$temp_dir"
cd "$temp_dir"
git checkout "v$version"

echo "Cloned repository and checked out version v$version"

# Build the binary
cargo build --release

echo "Built binary"

# Create the installation directory
mkdir -p "$install_path/bin"

# Copy the binary to the installation directory
cp target/release/starknet-contract-verifier "$install_path/bin/"

# Make the binary executable
chmod +x "$install_path/bin/starknet-contract-verifier"

echo "Installation complete" 